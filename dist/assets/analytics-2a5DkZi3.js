import{r as e,j as s}from"./vendor-react-r6j4PRy1.js";import{A as a}from"./chat-CNf6KRkl.js";import"./vendor-date-DJxzBke1.js";const i=e.memo(function({socket:i}){const[c,l]=e.useState({totalConversations:0,activeConversations:0,unansweredChats:0,messagesReceived:0,messagesSent:0,avgResponseTime:0,maxWaitingTime:0,medianResponseTime:0,leadsWon:0,leadsActive:0,leadsLost:0,leadsTasks:0,leadsWithoutTasks:0,messagesBySource:[],thisWeek:{conversations:0,messages:0,leads:0},lastWeek:{conversations:0,messages:0,leads:0}}),[r,n]=e.useState("today"),[t,d]=e.useState(!0),m=e.useCallback(async()=>{try{const e=await fetch(`${a}/api/metrics?period=${r}`),s=await e.json();l(s),d(!1)}catch(e){d(!1)}},[r]),h=e.useCallback(e=>{l(e)},[]);e.useEffect(()=>{m();const e=setInterval(m,3e4);return i?(i.on("metrics-updated",h),()=>{i.off("metrics-updated",h),clearInterval(e)}):()=>clearInterval(e)},[m,i,h]);const o=e.useCallback(e=>e<60?`${Math.round(e)}s`:e<3600?`${Math.round(e/60)}m`:`${Math.round(e/3600)}h`,[]),v=e.useCallback((e,s)=>0===s?0:Math.round(e/s*100),[]),x=e.useCallback((e,s)=>{if(0===s)return{value:"+100",positive:!0};const a=Math.round((e-s)/s*100);return{value:a>0?`+${a}`:`${a}`,positive:a>=0}},[]),j=e.useMemo(()=>x(c.thisWeek.conversations,c.lastWeek.conversations),[c.thisWeek.conversations,c.lastWeek.conversations,x]),N=e.useMemo(()=>x(c.thisWeek.messages,c.lastWeek.messages),[c.thisWeek.messages,c.lastWeek.messages,x]),p=e.useMemo(()=>x(c.thisWeek.leads,c.lastWeek.leads),[c.thisWeek.leads,c.lastWeek.leads,x]);return t?s.jsxs("div",{className:"analytics-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Carregando métricas..."})]}):s.jsxs("div",{className:"analytics-container",children:[s.jsxs("div",{className:"analytics-header",children:[s.jsx("h1",{children:"Analytics"}),s.jsxs("div",{className:"analytics-filters",children:[s.jsx("button",{className:"filter-button "+("today"===r?"active":""),onClick:()=>n("today"),children:"Hoje"}),s.jsx("button",{className:"filter-button "+("week"===r?"active":""),onClick:()=>n("week"),children:"Semana"}),s.jsx("button",{className:"filter-button "+("month"===r?"active":""),onClick:()=>n("month"),children:"Mês"}),s.jsx("button",{className:"filter-button "+("all"===r?"active":""),onClick:()=>n("all"),children:"Todos"})]})]}),s.jsxs("div",{className:"analytics-grid",children:[s.jsxs("div",{className:"metric-card primary",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"MENSAGENS RECEBIDAS"})}),s.jsx("div",{className:"metric-value-large",children:c.messagesReceived}),s.jsx("div",{className:"metric-subtitle",children:"esta semana"}),s.jsxs("div",{className:"metric-breakdown",children:[s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M10,12A1.5,1.5 0 0,1 8.5,10.5A1.5,1.5 0 0,1 10,9A1.5,1.5 0 0,1 11.5,10.5A1.5,1.5 0 0,1 10,12M20,2H4C2.89,2 2,2.89 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2Z"})}),s.jsx("span",{children:"WhatsApp Lite"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"whatsapp-lite"===e.source)?.count||0})]}),s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M12,3C6.5,3 2,6.58 2,11C2.05,13.15 3.06,15.17 4.75,16.5C4.75,17.1 4.33,18.67 2,21C4.37,20.89 6.64,20 8.47,18.5C9.61,18.83 10.81,19 12,19C17.5,19 22,15.42 22,11C22,6.58 17.5,3 12,3M12,17C7.58,17 4,14.31 4,11C4,7.69 7.58,5 12,5C16.42,5 20,7.69 20,11C20,14.31 16.42,17 12,17Z"})}),s.jsx("span",{children:"WhatsApp Cloud API"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"whatsapp-cloud"===e.source)?.count||0})]}),s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M16.5,1.5A2.5,2.5 0 0,0 14,4A2.5,2.5 0 0,0 16.5,6.5A2.5,2.5 0 0,0 19,4A2.5,2.5 0 0,0 16.5,1.5M9,3C6.27,3 4,4.66 4,6.73C4,8.79 6.27,10.45 9,10.45C11.73,10.45 14,8.79 14,6.73C14,4.66 11.73,3 9,3M5,11C2.5,11 1,12.5 1,14.5C1,16.5 2.5,18 5,18C7.5,18 9,16.5 9,14.5C9,12.5 7.5,11 5,11M13,11C10.5,11 9,12.5 9,14.5C9,16.5 10.5,18 13,18C15.5,18 17,16.5 17,14.5C17,12.5 15.5,11 13,11M21,13C18.24,13 16,14.9 16,17.23C16,19.56 18.24,21.45 21,21.45C23.76,21.45 26,19.56 26,17.23C26,14.9 23.76,13 21,13Z"})}),s.jsx("span",{children:"Outros"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"outros"===e.source)?.count||0})]})]}),s.jsxs("div",{className:"metric-change",children:[s.jsx("span",{className:"change-indicator "+(N.positive?"positive":"negative"),children:N.value}),s.jsx("span",{children:"esta semana"})]})]}),s.jsxs("div",{className:"metric-card secondary",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"CONVERSAS ATIVAS"})}),s.jsx("div",{className:"metric-value",children:c.activeConversations}),s.jsxs("div",{className:"metric-change",children:[s.jsx("span",{className:"change-indicator "+(j.positive?"positive":"negative"),children:j.value}),s.jsx("span",{children:"esta semana"})]})]}),s.jsxs("div",{className:"metric-card tertiary",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"CHATS SEM RESPOSTAS"})}),s.jsx("div",{className:"metric-value",children:c.unansweredChats})]}),s.jsxs("div",{className:"metric-card info",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"FONTES DE LEAD"})}),s.jsxs("div",{className:"circular-progress",children:[s.jsxs("svg",{viewBox:"0 0 200 200",className:"progress-ring",children:[s.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#1e3a5f",strokeWidth:"20"}),s.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#f39c12",strokeWidth:"20",strokeDasharray:5.03*v(c.leadsActive,c.totalConversations)+" 502.65",strokeDashoffset:"0",transform:"rotate(-90 100 100)"})]}),s.jsx("div",{className:"progress-label",children:s.jsx("div",{className:"progress-phone",children:"5519941518973"})})]})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"TEMPO DE RESPOSTA"})}),s.jsx("div",{className:"metric-value time",children:o(c.avgResponseTime)}),s.jsx("div",{className:"metric-subtitle",children:"esta semana"})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"MAIS TEMPO ESPERANDO"})}),s.jsx("div",{className:"metric-value time",children:o(c.maxWaitingTime)})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"LEADS GANHOS"})}),s.jsx("div",{className:"metric-value",children:c.leadsWon}),s.jsx("div",{className:"metric-subtitle",children:"R$0"}),s.jsx("div",{className:"metric-progress",children:s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill green",style:{width:`${v(c.leadsWon,c.totalConversations)}%`}})})}),s.jsxs("div",{className:"metric-change",children:[s.jsx("span",{className:"change-indicator "+(p.positive?"positive":"negative"),children:p.value}),s.jsx("span",{children:"esta semana"})]})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"LEADS ATIVOS"})}),s.jsx("div",{className:"metric-value",children:c.leadsActive}),s.jsx("div",{className:"metric-subtitle",children:"R$0"}),s.jsx("div",{className:"metric-progress",children:s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill blue",style:{width:`${v(c.leadsActive,c.totalConversations)}%`}})})}),s.jsxs("div",{className:"metric-change",children:[s.jsx("span",{className:"change-indicator positive",children:"+307"}),s.jsx("span",{children:"esta semana"})]})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"TAREFAS"})}),s.jsx("div",{className:"metric-value",children:c.leadsTasks})]}),s.jsxs("div",{className:"metric-card large",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"TEMPO MÉDIO DE RESPOSTA"})}),s.jsx("div",{className:"metric-value-huge time",children:o(c.medianResponseTime)}),s.jsx("div",{className:"metric-subtitle",children:"esta semana"})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"LEADS PERDIDOS"})}),s.jsx("div",{className:"metric-value",children:c.leadsLost}),s.jsx("div",{className:"metric-subtitle",children:"R$0"}),s.jsx("div",{className:"metric-progress",children:s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill red",style:{width:`${v(c.leadsLost,c.totalConversations)}%`}})})}),s.jsxs("div",{className:"metric-change",children:[s.jsx("span",{className:"change-indicator positive",children:"0"}),s.jsx("span",{children:"esta semana"})]})]}),s.jsxs("div",{className:"metric-card",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"LEADS SEM TAREFAS"})}),s.jsx("div",{className:"metric-value",children:c.leadsWithoutTasks}),s.jsx("div",{className:"metric-subtitle",children:"R$0"}),s.jsx("div",{className:"metric-progress",children:s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill orange",style:{width:`${v(c.leadsWithoutTasks,c.totalConversations)}%`}})})}),s.jsxs("div",{className:"metric-change",children:[s.jsx("span",{className:"change-indicator positive",children:"0"}),s.jsx("span",{children:"esta semana"})]})]}),s.jsxs("div",{className:"metric-card full-width",children:[s.jsx("div",{className:"metric-header",children:s.jsx("span",{className:"metric-label",children:"MENSAGENS ENVIADAS"})}),s.jsx("div",{className:"metric-value-large",children:c.messagesSent}),s.jsx("div",{className:"metric-subtitle",children:"esta semana"}),s.jsxs("div",{className:"metric-breakdown",children:[s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M10,12A1.5,1.5 0 0,1 8.5,10.5A1.5,1.5 0 0,1 10,9A1.5,1.5 0 0,1 11.5,10.5A1.5,1.5 0 0,1 10,12M20,2H4C2.89,2 2,2.89 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2Z"})}),s.jsx("span",{children:"WhatsApp Lite"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"whatsapp-lite"===e.source)?.sent||0})]}),s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M12,3C6.5,3 2,6.58 2,11C2.05,13.15 3.06,15.17 4.75,16.5C4.75,17.1 4.33,18.67 2,21C4.37,20.89 6.64,20 8.47,18.5C9.61,18.83 10.81,19 12,19C17.5,19 22,15.42 22,11C22,6.58 17.5,3 12,3M12,17C7.58,17 4,14.31 4,11C4,7.69 7.58,5 12,5C16.42,5 20,7.69 20,11C20,14.31 16.42,17 12,17Z"})}),s.jsx("span",{children:"WhatsApp Cloud API"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"whatsapp-cloud"===e.source)?.sent||0})]}),s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})}),s.jsx("span",{children:"Bate-papo online"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"web-chat"===e.source)?.sent||0})]}),s.jsxs("div",{className:"breakdown-item",children:[s.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",children:s.jsx("path",{fill:"currentColor",d:"M16.5,1.5A2.5,2.5 0 0,0 14,4A2.5,2.5 0 0,0 16.5,6.5A2.5,2.5 0 0,0 19,4A2.5,2.5 0 0,0 16.5,1.5M9,3C6.27,3 4,4.66 4,6.73C4,8.79 6.27,10.45 9,10.45C11.73,10.45 14,8.79 14,6.73C14,4.66 11.73,3 9,3M5,11C2.5,11 1,12.5 1,14.5C1,16.5 2.5,18 5,18C7.5,18 9,16.5 9,14.5C9,12.5 7.5,11 5,11M13,11C10.5,11 9,12.5 9,14.5C9,16.5 10.5,18 13,18C15.5,18 17,16.5 17,14.5C17,12.5 15.5,11 13,11M21,13C18.24,13 16,14.9 16,17.23C16,19.56 18.24,21.45 21,21.45C23.76,21.45 26,19.56 26,17.23C26,14.9 23.76,13 21,13Z"})}),s.jsx("span",{children:"Outros"}),s.jsx("span",{className:"breakdown-value",children:c.messagesBySource.find(e=>"outros"===e.source)?.sent||0})]})]})]})]})]})});export{i as default};
